# name: test/sql/rle/test_rle.test
# description: Basic RLE test with one column of integers
# group: [rle]

# load the DB from disk
load :rle:

statement ok
PRAGMA enable_rle

# create a database and insert values
statement ok
CREATE TABLE integers(i INTEGER)

statement ok
INSERT INTO integers VALUES (1), (1), (2), (3), (4),(4),(5)

# test if data is there
query I
SELECT * FROM integers order by i;
----
1
1
2
3
4
4
5

# create a table with two columns and insert values
statement ok
CREATE TABLE two_columns(i INTEGER, j REAL)

statement ok
INSERT INTO two_columns VALUES (1,2.2), (1,2.2), (2,1.2), (2,1.3), (2,2.1), (3,0.05), (NULL,0.05), (NULL, 0.025)

# verify that the tables are still there after a restart
restart

query I
SELECT * FROM integers order by i;
----
1
1
2
3
4
4
5

#insert more stuff
statement ok
INSERT INTO integers VALUES (1), (1), (2), (3), (4),(4),(5)

# test data
query I
SELECT * FROM integers order by i;
----
1
1
1
1
2
2
3
3
4
4
4
4
5
5

# insert some null values
statement ok
INSERT INTO integers VALUES (NULL), (NULL), (NULL)

# test data
query I
SELECT * FROM integers order by i;
----
NULL
NULL
NULL
1
1
1
1
2
2
3
3
4
4
4
4
5
5

query I
SELECT COUNT(*) FROM integers where i is null;
----
3

# test filters in compressed segment
query I
SELECT * FROM integers where i = 3;
----
3
3

query I
SELECT * FROM integers where i >= 3 and i <5 order by i;
----
3
3
4
4
4
4


# test if data is there
query II
SELECT * FROM two_columns;
----
1	2.200000
1	2.200000
2	1.200000
2	1.300000
2	2.100000
3	0.050000
NULL	0.050000
NULL	0.0250000

query II
SELECT * FROM two_columns where i = 2 and j = 1.2;
----
2	1.200000

query II
SELECT * FROM two_columns where i is NULL
----
NULL	0.050000
NULL	0.0250000


query II
SELECT * FROM two_columns where i is NULL and j = 0.025
----
NULL	0.0250000

#try update out
statement ok
UPDATE two_columns set i = 10 where j=2.2

# test data
query II
SELECT * FROM two_columns
----
10	2.200000
10	2.200000
2	1.200000
2	1.300000
2	2.100000
3	0.050000
NULL	0.050000
NULL	0.0250000

# test data
query II
SELECT * FROM two_columns where i = 10
----
10	2.200000
10	2.200000

# test data
query II
SELECT * FROM two_columns where j = 2.2
----
10	2.200000
10	2.200000
